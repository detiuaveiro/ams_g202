<!DOCTYPE html>
<html lang="pt">
<head>
	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  	<title>Iniciar sessão | EcoMarket</title>
	
	<link rel="apple-touch-icon" sizes="180x180" href="/ams_g202/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/ams_g202/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/ams_g202/favicon-16x16.png">
	<link rel="icon" type="image/x-icon" href="/ams_g202/favicon.ico">

  	<script src="/ams_g202/js/jquery-2.0.0.min.js"></script>

  	<script src="/ams_g202/js/bootstrap.bundle.min.js"></script>
	<link href="/ams_g202/css/bootstrap.css" rel="stylesheet">
	  
	<script src="/ams_g202/js/universal-parallax.min.js"></script>

  	<link href="/ams_g202/fonts/fontawesome/css/all.min.css" rel="stylesheet">
  	<link href="/ams_g202/fonts/feathericons/css/iconfont.css" rel="stylesheet">
  	<link href="/ams_g202/fonts/material-icons/css/materialdesignicons.css" rel="stylesheet">

  	<link href="/ams_g202/css/ui.css" rel="stylesheet">
	<script src="/ams_g202/js/script.js"></script>
</head>
<body>
	<header class="section-header">
		<section class="header-main border-bottom">
			<div class="container">
				<div class="row align-items-center justify-content-between">
					<div class="col-lg-3 col-sm-4 col-md-4 col-5">
						<a class="navbar-brand" href="/ams_g202/marketplace/">
							<img src="/ams_g202/images/logo.svg" class="logo" alt="">
							<span class="font-weight-bolder text-success">Eco</span>Market
						</a>
					</div>
					<div class="col-lg-3 col-sm-8 col-md-4 col-7">
						<div class="d-flex justify-content-end">
							<div class="widget-header icontext">
								<a class="icon icon-sm rounded-circle border"><i class="fa fa-user"></i></a>
								<div class="text">
									<span class="text-muted">Bem-vindo!</span>
									<div class="mt-1"> 
										<a href="registration">Criar conta</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</header>

	<!-- ========================= SECTION CONTENT ========================= -->
	<section class="section-content padding-y bg" style="min-height:84vh">
		<div class="container">

	<!-- ============================ COMPONENT LOGIN   ================================= -->
		<div class="card mx-auto" style="max-width: 380px; margin-top:30px;">
			<div class="card-body">
			<h4 class="card-title mb-4 pb-2">Iniciar sessão</h4>
			<form id="login" action="">
				<div class="form-group mt-4">
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text"> <i class="fa fa-fw fa-envelope"></i> </span>
						</div>
						<input id="email" name="email" class="form-control" placeholder="Endereço de email" type="email" required>
					</div>
				</div>
				<div class="form-group">
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text"> <i class="fa fa-fw fa-lock"></i> </span>
						</div>
						<input id="password" name="password" class="form-control rounded-right" placeholder="Palavra-passe" type="password" required>
						<div class="invalid-feedback text-center mt-3">
							As credenciais introduzidas são inválidas.
						</div>
					</div>
					<div class="is-ready text-success small text-center mt-3 px-5" style="display: none;">
						Por favor inicie sessão com as credenciais da conta que acabou de criar.
					</div>
				</div>
				
				<div class="form-group">
					<a href="#" class="float-right"><u>Recuperar password</u></a> 
					<label class="float-left custom-control custom-checkbox">
						<input type="checkbox" class="custom-control-input" checked><div class="custom-control-label">Lembrar-me</div>
					</label>
				</div>
				<div class="form-group py-2">
					<button type="submit" class="btn btn-primary btn-block">Iniciar sessão</button>
				</div>

				<p class="text-center mt-4">ou inicie sessão através de</p>
				<div class="text-center mb-4">
					<a href="#" class="btn btn-icon rounded-circle btn-facebook"> <i class="fab fa-facebook-f"></i> </a>
					<a href="#" class="btn btn-icon rounded-circle btn-google"> <i class="fab fa-google"></i> </a>
					<a href="#" class="btn btn-icon rounded-circle btn-dark"> <i class="fab fa-apple"></i> </a>  
				</div>
			</form>
			
			<hr>
			<p class="text-center mt-4">Ainda não tem uma conta? <a href="registration"><u>Crie uma aqui</u></a></p>

			</div>
		</div>
	<!-- ============================ COMPONENT LOGIN  END.// ================================= -->

		</div>
	</section>
	<!-- ========================= SECTION CONTENT END// ========================= -->


	<footer class="section-footer border-top shadow pt-2 pb-2">
		<div class="container">
			<section class="footer-copyright d-flex align-items-center justify-content-between">
				<p class="mt-0 pt-3 text-muted">© 2021 EcoMarket</p>
				<div class="mt-0">
					<a href="mailto:ecomarket@ua.pt" class="btn btn-light">
						<img src="/ams_g202/images/icons/support.png" alt="" width="25" style="filter: contrast(0.4);">
						<span class="ml-1 text-secondary">Apoio ao Cliente</span>
					</a>
				</div>
			</section>
		</div>
	</footer>

	<script>
		$(document).ready(function(){

			if (window.location.search.indexOf('?type=') > -1){
				// If form data starts with '?type=', then the user came from registration page and his account is created and ready to be used to sign in
				$('.is-ready').show();
			} else if (window.location.search.indexOf('?email=') > -1){
				// If form data starts with '?email=', then the user came from login page and entered invalid login credentials
				$('#login #email, #login #password').addClass('is-invalid');
			}

			$('#login').on('submit', function(e){

				if(typeof(Storage) !== "undefined"){
					// If no storage is detected, create and store both demo accounts by default
					if (!localStorage.getItem('ecomarket_accounts')){

						var accounts = new Array();
						customerAccount = new Object();
						producerAccount = new Object();
						
						// Create demo customer account
						customerAccount = {
							email: 'cliente@ua.pt',
							password: btoa('cliente'),		// Base64 encode
							type: 'cliente',
							avatar: '/ams_g202/images/avatars/avatar.jpg',
							name: 'Joaquim Raro, Lda',
							firstname: 'Calisto',
							surname: 'Comum',
							nif: '',
							phone: '969696969',
							district: 'Aveiro',
							county: 'Aveiro',
							parish: 'Glória',
							zip: '3810-104',
							address: 'Rua Dr. Calisto Raro',
							number: '20',
							floor: '3º direito',
							in_progress_orders: '1',
							completed_orders: '3',
							refunded_orders: '0'
						};
						// Create demo producer account
						producerAccount = {
							email: 'produtor@ua.pt',
							password: btoa('produtor'),		// Base64 encode
							type: 'produtor',
							avatar: '/ams_g202/images/avatars/avatar.jpg',
							name: 'Joaquim Raro, Lda',
							firstname: '',
							surname: '',
							nif: '123456789',
							phone: '238238238',
							district: 'Aveiro',
							county: 'Aveiro',
							parish: 'Vera Cruz',
							zip: '3810-132',
							address: 'Avenida Dr. Joaquim Comum',
							number: '120',
							floor: '3º esquerdo',
							in_progress_orders: '2',
							completed_orders: '1',
							refunded_orders: '0'
						};
						accounts.push(customerAccount);
						accounts.push(producerAccount);
						
						// Store data (both demo accounts) on storage
						localStorage.setItem('ecomarket_accounts', JSON.stringify(accounts));
					}

					// Get all saved accounts on storage
					accounts = JSON.parse(localStorage.getItem('ecomarket_accounts'));

					// Get values entered by the user on the login fields
					var email = document.getElementById('email').value;
					var password = document.getElementById('password').value;
					
					// Cycle through all accounts stored
					accounts.forEach(function(object){
						// Compares both email and password entered by the user with the stored ones
						if(object.email == email && atob(object.password) == password){		// Base64 decode

							// Store session data on the storage item and remember that this account is logged in
							localStorage.setItem('ecomarket_session', JSON.stringify(object));

							// After a valid login, choose where to redirect the user, according to their account type
							if (object.type == 'produtor'){
								// A producer account goes to sell page
								$('#login').attr('action', 'sell');
							} else{
								// A customer account goes to buy page
								$('#login').attr('action', 'buy');
							}
						}
					});

				} else{
					// Browser does not support web storage
					window.location.replace("/ams_g202/marketplace/error");
				}

			});
		});
	</script>
</body>
</html>